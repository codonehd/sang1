대체거래소(ATS) 도입에 따른 키움 Open API \+ 변경 안내  


※ 안내는 1\. 조회, 실시간 시세 · 2\. 주문, 실시간 체결/잔고 통보 · 3\. 조건검색, 실시간 조건검색 순서로 진행됩니다. 


1\. 조회, 실시간 시세  


대체거래소 지원으로 한국거래소 시세(이하 KRX), 넥스트레이드 시세(이하 NXT), 통합시세(또는 통합호가종 목시세, 이하 ALL)로 분류 

// NXT대상 종목 6자리 종목코드를 ';'로 구분해서 전달 

sNXTList \= GetCodeListByMarket("NXT"); 

종목코드로 분기 (대상TR 68개) 

입력항목에 "종목코드"가 있는 TR (OPT10001, OPT10002, OPT10003 등)에서 조회방법 

KRX조회는 기존 6자리 종목코드 그대로 사용 

NXT, 통합종목은 기존 6자리 종목코드에 "\_NX", "\_AL"추가  

예시) "039490"의 KRX, NXT, 통합종목, 종목코드 "039490", "039490\_NX", "039490\_AL" 

// 통합 조회 요청  

SetInputValue("종목코드" , "039490\_AL");  

CommRqData(RQName , "OPT10001" , "0" , "화면번호");  

// NXT 조회 요청 

SetInputValue("종목코드" , "039490\_NX");

1   
CommRqData(RQName , "OPT10001" , "0" , "화면번호"); 

실시간 시세데이터, 종목코드 

// 실시간 시세 데이터 종목코드는 조회한 종목코드로 전달 

"039490\_AL" 조회시 "종목코드 \= 039490\_AL" 

"039490\_NX" 조회시 "종목코드 \= 039490\_NX" 

※ 주의사항 

OpenAPI TR목록은 요건에 따라 수시로 변경될 수 있으로 OpenAPI버전처리후 KOA Studio로 확인해주세 요. 

TR 입력항목 "거래소구분" 추가 (대상 TR 43개) 

거래소구분=1:KRX, 2:NXT, 3:통합  

거래소구분=1, 2, 3으로 조회시 각각 KRX, NXT, 통합종목 데이터 조회  

OPT10016 : 신고저가요청 

OPT10017 : 상하한가요청 

OPT10018 : 고저가근접요청 

OPT10019 : 가격급등락요청 

OPT10020 : 호가잔량상위요청 

OPT10021 : 호가잔량급증요청 

OPT10022 : 잔량율급증요청 

OPT10023 : 거래량급증요청 

OPT10024 : 거래량갱신요청 

OPT10025 : 매물대집중요청 

OPT10026 : 고저PER요청 

OPT10027 : 전일대비등락률상위요청

2   
OPT10028 : 시가대비등락률요청 OPT10029 : 예상체결등락률상위요청 OPT10030 : 당일거래량상위요청 OPT10031 : 전일거래량상위요청 OPT10032 : 거래대금상위요청 

OPT10033 : 신용비율상위요청 

OPT10034 : 외인기간별매매상위요청 OPT10035 : 외인연속순매매상위요청 OPT10036 : 외인한도소진율증가상위 OPT10037 : 외국계창구매매상위요청 OPT10039 : 증권사별매매상위요청 

OPT10042 : 순매수거래원순위요청 OPT10043 : 거래원매물대분석요청 OPT10047 : 체결강도추이일별요청 OPT10051 : 업종별투자자순매수요청 

OPT10052 : 거래원순간거래량요청 OPT10054 : 변동성완화장치발동종목요청 OPT10058 : 투자자별일별매매종목요청 OPT10062 : 동일순매매순위요청 OPT10063 : 장중투자자별매매요청 OPT10066 : 장중투자자별매매차트요청 OPT10131 : 기관외국인연속매매현황요청 OPT40004 : ETF전체시세요청 

OPT90001 : 테마그룹별요청 

OPT90002 : 테마구성종목요청 

OPT90003 : 프로그램순매수상위50요청

3   
OPT90004 : 종목별프로그램매매현황요청 

OPT90005 : 프로그램매매추이요청 

OPT90006 : 프로그램매매차익잔고추이요청 

OPT90007 : 프로그램매매누적추이요청 

OPT90009 : 외국인기관매매상위요청 

※ 주의사항 

OpenAPI TR목록은 요건에 따라 수시로 변경될 수 있으로 OpenAPI버전처리후 KOA Studio로 확인해주세 요. 

거래소구분=0:통합, 1:KRX, 2:NXT (대상TR 3개)  

거래소구분=0, 1, 2으로 조회시 각각 통합종목 시세, KRX시세, NXT 시세 조회  

OPT10075 : 미체결요청 

OPT10076 : 체결요청 

OPT10085 : 계좌수익률요청 

거래소구분=KRX:한국거래소, NXT:대체거래소 (대상TR 3개)  

OPW00004 : 계좌평가현황요청 

OPW00005 : 체결잔고요청 

OPW00018 : 계좌평가잔고내역요청 

거래소구분=%:전체, KRX:한국거래소, NXT:대체거래소, SOR:최선주문집행 (대상TR 3개)  OPW00007 : 계좌별주문체결내역상세요청 

OPW00009 : 계좌별주문체결현황요청 

OPW00015 : 위탁종합거래내역요청

4   
2\. 주문, 실시간 체결/잔고 통보  


NXT, SOR 주문유형(또는 매매유형)추가, 현금/신용주문함수 공통 

※ 종목코드는 현금/신용주문 모두 기존 6자리 종목코드 사용. "039490" 

NXT주문 21=NXT매수, 22=NXT매도, 23=NXT취소, 25= NXT정정 (주의 24 아님\!\!)  SOR주문 11=SOR매수, 12=SOR매도, 13=SOR취소, 15=SOR정정 (주의 14 아님\!\!)  

중간가 주문 

현금주문, 신용주문 공통으로 거래구분(호가구분)값 “29”로 설정, 주문가격은 ‘0’으로 설정 

\[거래구분\]  

00 : 지정가 

03 : 시장가 

05 : 조건부지정가 

06 : 최유리지정가 

07 : 최우선지정가 

10 : 지정가IOC  

13 : 시장가IOC  

16 : 최유리IOC  

20 : 지정가FOK  

23 : 시장가FOK  

26 : 최유리FOK  

28 : 스탑지정가 

29 : 중간가 

61 : 장전시간외종가

5   
62 : 시간외단일가매매 

81 : 장후시간외종가 

※ 모의투자에서는 지정가 주문과 시장가 주문만 가능합니다. 

스탑지정가 주문 

기존 함수는 스탑가 설정불가로 KOA\_Functions()를 이용한 별도 현금/신용 주문함수를 제공 기존 현금주문, 신용 주문함수에 2개 인자 "스탑지정가격", "예약인자" 추가 

현금주문 예시 

KOA\_Function("SendOrder\_Ex", strParam); // 기본 함수명과 파라미터 KOA\_Functions("sendorder\_ex", strParam); // 소문자 함수명 사용가능 

신용주문 예시 

KOA\_Function("SendOrderCredit\_Ex", strParam); // 기본 함수명과 파라미터 KOA\_Function("sendordercredit\_ex", strParam); // 소문자 함수명 사용가능 

새 함수는 기존 현금/신용 주문함수에 2개 인자 "스탑지정가격", "예약인자" 추가 스탑지정가를 포함해서 기존 거래구분 주문도 사용가능 

// 현금주문 인자 설명 

// 기존 주문함수에 "스탑지정가격", "예약인자" 추가, 총 11개 각 인자는 ','로 분리해서 설정 strParam.Format(\_T("%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s") 

, sRQName // 사용자 구분명 

, sScreenNo // 화면번호 

, sAccNo // 계좌번호 10자리 

, sOrderType // 주문유형

6   
, sCode // 종목코드 (6자리) 

, sQty // 주문수량 

, sPrice // 주문가격 

, sHogaGb // 거래구분 (혹은 호가구분) 스탑지정가 주문시 "28" 설정 , sOrgOrderNo // 원주문번호 

, sCondPrice // 스톱가 

, sReserve // 예약인자(공백입력) 

); 

// "039490"종목, 현금, NXT매수(21), 주문가격(115800), 스톱가(115000) 스톱지정가 주문 인자 설정 strParam.Format(\_T("%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s") 

, "현금주문" 

, "4989" 

, "1111222210" 

, "21" 

, "039490" 

, "1" 

, "115800" 

, "28" // 거래구분, 스톱지정가(28) 

, "" 

, "115000" // 스톱가 

, "" 

); 

// 새 현금 주문함수 호출, "0"이면 호출 성공 이외에는 호출 실패 

strRet \= KOA\_Functions(\_T("SendOrder\_Ex"), strParam);

7   
// 소문자 주문명 호출 

strRet \= KOA\_Functions(\_T("sendorder\_ex"), strParam); 

// 신용주문 인자 설명 

// 기존 주문함수에 "스탑지정가격", "예약인자" 추가, 총 13개 각 인자는 ','로 분리해서 설정 strParam.Format(\_T("%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s") 

, sRQName // 사용자 구분명 

, sScreenNo // 화면번호 

, sAccNo // 계좌번호 10자리 

, sOrderType // 주문유형 

, sCode // 종목코드 (6자리) 

, sQty // 주문수량 

, sPrice // 주문가격 

, sHogaGb // 거래구분 (혹은 호가구분) 스탑지정가 주문시 "28" 설정 , sCreditGb // 신용거래구분 

, sLoanDate // 대출일 (YYYYMMDD형식.) 

, sOrgOrderNo // 원주문번호 

, sCondPrice // 스톱가 

, sReserve // 예약인자(공백입력) 

); 

// 인자 설정과 함수호출 예시 

// "039490"종목, 신용(03), NXT매수(21), 주문가격(115800), 스톱가(115000) 스톱지정가 주문 인자 설정 strParam.Format(\_T("%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s") 

, "신용주문"

8   
, "0334" 

, "1111222210" 

, "21" 

, "039490" 

, "1" 

, "115800" 

, "28" // 거래구분, 스톱지정가(28) 

, "03" 

, "" 

, "" 

, "115000" // 스톱가 

, "" 

); 

// 새 신용 주문함수 호출, "0"이면 호출 성공 이외에는 호출 실패 

strRet \= KOA\_Functions(\_T("SendOrderCredit\_Ex"), strParam); 

// 소문자 주문명 호출 

strRet \= KOA\_Functions(\_T("sendordercredit\_ex"), strParam); 

3\. 조건검색, 실시간 조건검색 

대체거래소 도입과 관련하여 키움 OpenAPI+에 추가된 조건검색, 실시간 조건검색 기능은 당분간 지원되지 않습니다. 

\- 조건검색, 실시간 조건검색은 KRX 시세 데이터를 사용한 결과만 조회됩니다. 

\- 대체거래소 도입과 관련하여 신규 추가된 아래 함수 호출 시 항상 ""가 리턴됩니다.

9   
 . KOA\_Functions(\_T("GetConditionName\_NXT"), " 영웅 조건식");  . KOA\_Functions(\_T("getconditionname\_nxt"), " 영웅 조건식");  . KOA\_Functions(\_T("GetConditionName\_ALL"), " 영웅 조건식");  . KOA\_Functions(\_T("getconditionname\_all"), " 영웅 조건식");  . KOA\_Functions(\_T("GetExchangeName"), sCondionName);  . KOA\_Functions(\_T("getexchangename"), sCondionName);

10 